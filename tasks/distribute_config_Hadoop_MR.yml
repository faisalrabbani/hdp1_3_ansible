- hosts: hadoop_cluster
  sudo: Yes
  vars_files:
        - [ "../vars/dirsHDP.yml" ]
        - [ "../vars/userGrp.yml" ]
        - [ "../vars/network.yml" ]
        - [ "../roles/hadoop_cluster/vars/main.yml" ]
  tasks:
        - name: HDP | Copy configuration files
          template: src=../roles/hadoop_cluster/templates/{{item}}.j2 dest=${HADOOP_CONF_DIR}/{{item}} owner=${HDFS_USER} group=${HADOOP_GROUP} mode=755
          with_items:
                - capacity-scheduler.xml
                - commons-logging.properties
                - core-site.xml
                - hadoop-env.sh
                - hadoop-metrics2.properties
                - hadoop-policy.xml
                - hdfs-site.xml
                - mapred-site.xml
                - mapreduce-queue-acls.xml
                - taskcontroller.cfg

        - name: COMMON | Set pam
          lineinfile: dest=/etc/pam.d/login regexp="^session required pam_limits.so" line="session required pam_limits.so" state=present

        - name: COMMON | Set ulimit - soft
          lineinfile: dest=/etc/security/limits.conf regexp="^hadoop soft nofile 32768" line="hadoop soft nofile 32768" state=present

        - name: COMMON | Set ulimit - hard
          lineinfile: dest=/etc/security/limits.conf regexp="^hadoop hard nofile 32768" line="hadoop hard nofile 32768" state=present

        - name: COMMON | Set ulimit - soft
          lineinfile: dest=/etc/security/limits.conf regexp="^hdfs soft nofile 32768" line="hdfs soft nofile 32768" state=present

        - name: COMMON | Set ulimit - hard
          lineinfile: dest=/etc/security/limits.conf regexp="^hdfs hard nofile 32768" line="hdfs hard nofile 32768" state=present

        - name: COMMON | Set ulimit - soft
          lineinfile: dest=/etc/security/limits.conf regexp="^mapred soft nofile 32768" line="mapred soft nofile 32768" state=present

        - name: COMMON | Set ulimit - hard
          lineinfile: dest=/etc/security/limits.conf regexp="^mapred hard nofile 32768" line="mapred hard nofile 32768" state=present
